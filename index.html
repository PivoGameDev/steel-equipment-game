<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Собери пивной завод</title>
    <style>
        /* ВСЕ СТИЛИ ЗДЕСЬ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            background-color: #f5f7fa;
            user-select: none;
            padding: 10px;
        }

        .screen {
            width: 100%;
            max-width: 900px;
            height: 95vh;
            max-height: 700px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: absolute;
            padding: 12px 15px 5px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
            background: white;
        }

        .hidden {
            display: none !important;
        }

        /* Стартовый экран */
        #start-screen {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            z-index: 100;
            justify-content: flex-start;
            padding: 20px 15px;
        }

        .logo-container {
            margin: 10px auto 15px;
            width: 300px;
            height: 320px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .game-logo {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .game-titles {
            margin-bottom: 15px;
            width: 100%;
        }

        .game-title {
            font-size: 3.2rem;
            margin-bottom: 5px;
            letter-spacing: 2px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            animation: title-appear 1s ease-out;
        }

        .game-name {
            font-size: 2.5rem;
            margin-bottom: 5px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            background: linear-gradient(to right, #ffd700, #ff8c00, #ff4500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
            animation: name-appear 1.2s ease-out;
        }

        @keyframes title-appear {
            0% { transform: translateY(-20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        @keyframes name-appear {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .welcome-text {
            font-size: 1.2rem;
            max-width: 80%;
            margin: 0 auto 25px;
            line-height: 1.5;
        }

        #start-btn {
            margin-top: 15px;
            padding: 16px 45px;
            font-size: 1.3rem;
            background-color: #4ade80;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(74, 222, 128, 0.4);
        }

        #start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(74, 222, 128, 0.6);
        }

        /* Экран выбора уровня */
        #level-select-screen {
            background: linear-gradient(135deg, #6b73ff 0%, #000dff 100%);
            color: white;
            z-index: 90;
            justify-content: flex-start;
            padding-top: 15px;
        }

        .level-select-title {
            font-size: 24px;
            margin-bottom: 20px;
            padding: 0 10px;
        }

        .level-cards {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
            width: 100%;
            overflow-y: auto;
            max-height: 65%;
            padding: 5px;
        }

        .level-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 15px;
            width: 45%;
            min-width: 140px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            margin: 5px;
        }

        .level-card h2 {
            color: #3b82f6;
            margin-bottom: 8px;
            font-size: 18px;
        }

        .level-card p {
            margin: 5px 0;
            color: #4b5563;
            font-size: 14px;
        }

        .lock-icon {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7) url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="36px" height="36px"><path d="M0 0h24v24H0z" fill="none"/><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg>') center no-repeat;
            border-radius: 15px;
        }

        .lock-icon.hidden {
            display: none;
        }

        .level-stars {
            margin-top: 8px;
            font-size: 20px;
            color: #fbbf24;
            letter-spacing: 2px;
            height: 24px;
        }

        #back-to-menu {
            margin-top: 15px;
            padding: 10px 25px;
            background: white;
            color: #3b82f6;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
        }

        /* Игровой экран */
        #game-screen {
            background-color: white;
            z-index: 80;
            justify-content: flex-start;
            padding: 8px 12px 0;
        }

        .game-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            margin-bottom: 3px;
            flex-wrap: wrap;
        }

        .header-left, .header-right {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            min-width: 45%;
            padding: 0 5px;
        }

        .level-name {
            font-size: 16px;
            font-weight: bold;
            color: #3b82f6;
            text-align: left;
            margin-bottom: 2px;
        }

        .timer {
            font-size: 22px;
            font-weight: bold;
            color: #10b981;
        }

        .timer.low-time {
            color: #ef4444;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .feedback-message {
            height: 22px;
            font-weight: bold;
            margin: 2px 0;
            font-size: 15px;
            text-align: right;
            width: 100%;
            padding: 0 5px;
        }

        .feedback-message.correct {
            color: #10b981;
        }

        .feedback-message.incorrect {
            color: #ef4444;
        }

        /* Блок описания уровня */
        .level-description {
            width: calc(100% - 10px);
            background-color: #e0f2fe;
            border-radius: 10px;
            padding: 12px;
            margin: 3px 0 8px;
            font-size: 14px;
            text-align: left;
            max-height: 20vh;
            min-height: 100px;
            overflow-y: auto;
            line-height: 1.4;
        }

        #level-desc-text {
            color: #0c4a6e;
        }

        .game-container {
            display: flex;
            width: 100%;
            height: 65vh;
            max-height: 420px;
            gap: 12px;
            margin: 0 0 5px;
            flex-direction: column;
            padding: 0 5px;
        }

        .playground-container {
            flex: 3;
            background-color: #f3f4f6;
            border-radius: 10px;
            overflow-x: auto;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            min-height: 48%;
            white-space: nowrap;
        }

        .playground {
            display: inline-flex;
            justify-content: flex-start;
            align-items: center;
            gap: 15px;
            padding: 10px;
            height: 100%;
        }

        .equipment-panel-container {
            flex: 2;
            background-color: #f3f4f6;
            border-radius: 10px;
            padding: 10px;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            overflow-x: auto;
            min-height: 42%;
            white-space: nowrap;
        }

        .equipment-panel {
            display: inline-flex;
            gap: 15px;
            height: 100%;
        }

        .slot {
            width: 180px;
            height: 180px;
            background-color: #e5e7eb;
            border: 2px dashed #9ca3af;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 10px;
            transition: all 0.3s;
            position: relative;
            flex-shrink: 0;
        }

        /* Номер слота */
        .slot-number {
            position: absolute;
            top: 5px;
            left: 5px;
            background-color: #3b82f6;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 14px;
            z-index: 5;
        }

        .slot.highlight-correct {
            animation: highlight-green 0.5s;
        }

        .slot.highlight-incorrect {
            animation: highlight-red 0.5s;
        }

        .slot.hint-highlight {
            animation: hint-pulse 2s infinite;
        }

        @keyframes highlight-green {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }

        @keyframes highlight-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        @keyframes hint-pulse {
            0% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.7); }
            50% { box-shadow: 0 0 0 15px rgba(245, 158, 11, 0.3); }
            100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0); }
        }

        .equipment-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            background-color: #e5e7eb;
            width: 180px;
            height: 180px;
            flex-shrink: 0;
        }

        .equipment {
            width: 150px;
            height: 150px;
            pointer-events: none;
            object-fit: contain;
        }

        .equipment-placed {
            width: 100%;
            height: 100%;
            object-fit: contain;
            z-index: 2;
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            width: 100%;
            padding: 0 10px 5px;
            flex-wrap: wrap;
            margin-top: 5px;
        }

        #hint-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
            min-width: 140px;
            flex: 1;
            max-width: 200px;
        }

        #hint-btn:disabled {
            background: #9ca3af;
            box-shadow: none;
            cursor: not-allowed;
            opacity: 0.6;
        }

        #hint-btn:not(:disabled):hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(245, 158, 11, 0.6);
        }

        #launch-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
            min-width: 160px;
            flex: 1;
            max-width: 200px;
        }

        #launch-btn:disabled {
            background: #9ca3af;
            box-shadow: none;
            cursor: not-allowed;
        }

        #launch-btn:not(:disabled):hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(59, 130, 246, 0.6);
        }

        /* Экран победы */
        #win-screen {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            z-index: 100;
            justify-content: center;
            padding: 20px;
        }

        .win-text {
            animation: blink 1s infinite alternate;
            margin-bottom: 15px;
        }

        @keyframes blink {
            from { opacity: 1; }
            to { opacity: 0.8; }
        }

        #stars-earned {
            font-size: 24px;
            letter-spacing: 5px;
            color: #fbbf24;
            margin: 5px 0;
        }

        .next-level-btn {
            margin: 15px 5px 0;
            padding: 12px 25px;
            background: white;
            color: #10b981;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 200px;
        }

        .restart-btn {
            margin: 15px 5px 0;
            padding: 12px 25px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            border-radius: 50px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 200px;
        }

        .next-level-btn:hover, .restart-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .confetti {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
            overflow: hidden;
        }

        /* Экран проигрыша */
        #lose-screen {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            z-index: 100;
            justify-content: center;
            padding: 20px;
        }

        /* Модальное окно для подсказок */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }

        .modal.hidden {
            display: none;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border-radius: 15px;
            width: 80%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
            animation: modal-appear 0.4s ease-out;
        }

        @keyframes modal-appear {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .close-modal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            top: 10px;
            right: 15px;
        }

        .close-modal:hover {
            color: #333;
        }

        #hint-text {
            font-size: 18px;
            line-height: 1.5;
            color: #333;
            padding: 20px 10px;
            text-align: center;
        }

        /* Адаптивность для мобильных */
        @media (max-width: 768px) {
            .screen {
                height: 95vh;
                max-height: none;
                padding: 8px 10px 0;
            }
            
            .logo-container {
                width: 250px;
                height: 260px;
                margin: 5px auto 10px;
            }
            
            .game-title {
                font-size: 2.5rem;
            }
            
            .game-name {
                font-size: 2rem;
            }
            
            .welcome-text {
                font-size: 1.1rem;
                margin-bottom: 20px;
            }
            
            .game-container {
                height: 65vh;
                max-height: 400px;
                flex-direction: column;
                gap: 8px;
            }
            
            .playground-container {
                min-height: 50%;
            }
            
            .equipment-panel-container {
                min-height: 40%;
            }
            
            .level-cards {
                flex-direction: column;
                align-items: center;
                max-height: 60%;
            }
            
            .level-card {
                width: 100%;
                max-width: 300px;
                margin-bottom: 10px;
            }
            
            .level-description {
                font-size: 14px;
                padding: 10px;
                min-height: 100px;
                max-height: 100px;
            }
            
            .slot, .equipment-btn {
                width: 160px;
                height: 160px;
            }
            
            .equipment {
                width: 130px;
                height: 130px;
            }
            
            .game-header {
                margin-bottom: 0;
            }
            
            .header-left, .header-right {
                margin-bottom: 0;
            }
        }

        @media (min-width: 769px) {
            .slot, .equipment-btn {
                width: 170px;
                height: 170px;
            }
            
            .equipment {
                width: 140px;
                height: 140px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .screen {
                padding: 6px 8px 0;
                width: 100%;
                height: 98vh;
            }
            
            .logo-container {
                width: 200px;
                height: 210px;
                margin: 0 auto 10px;
            }
            
            .game-title {
                font-size: 2.2rem;
            }
            
            .game-name {
                font-size: 1.8rem;
            }
            
            .welcome-text {
                font-size: 1rem;
                margin-bottom: 15px;
            }
            
            #start-btn {
                padding: 14px 35px;
                font-size: 1.1rem;
            }
            
            .game-header {
                flex-direction: column;
                margin-bottom: 0;
            }
            
            .header-left, .header-right {
                align-items: center;
                width: 100%;
                margin-bottom: 3px;
            }
            
            .level-name, .timer {
                text-align: center;
                width: 100%;
                font-size: 15px;
            }
            
            .timer {
                font-size: 20px;
            }
            
            .feedback-message {
                text-align: center;
                font-size: 14px;
                height: 20px;
            }
            
            .slot, .equipment-btn {
                width: 145px;
                height: 145px;
            }
            
            .equipment {
                width: 115px;
                height: 115px;
            }
            
            #hint-btn, #launch-btn {
                padding: 10px 15px;
                font-size: 14px;
                min-width: 120px;
                max-width: 100%;
                flex: 1 0 80%;
                margin: 3px 0;
            }

            .game-controls {
                flex-direction: column;
                align-items: center;
                gap: 5px;
                padding: 0 5px 5px;
            }
            
            .level-card h2 {
                font-size: 16px;
            }
            
            .level-card p {
                font-size: 12px;
            }
            
            .level-description {
                margin: 2px 0 5px;
                min-height: 100px;
                max-height: 100px;
                padding: 8px;
                font-size: 13px;
            }
            
            .playground-container, 
            .equipment-panel-container {
                padding: 8px;
            }
        }

        /* Анимация для сообщений */
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(10px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-10px); }
        }

        .feedback-message {
            animation: fadeInOut 3s ease forwards;
        }
    </style>
</head>
<body>
    <!-- Стартовый экран -->
    <div id="start-screen" class="screen">
        <div class="logo-container">
            <img src="assets/images/logo.png" alt="Логотип пивного завода" class="game-logo">
        </div>
        <div class="game-titles">
            <h1 class="game-title">ИГРА</h1>
            <h1 class="game-name">Собери пивной завод</h1>
        </div>
        <p class="welcome-text">Установите оборудование в правильные слоты и запустите производство!</p>
        <button id="start-btn">Играть</button>
    </div>

    <!-- Экран выбора уровня -->
    <div id="level-select-screen" class="screen hidden">
        <h1 class="level-select-title">Выберите уровень сложности</h1>
        <div class="level-cards">
            <div class="level-card" data-level="1">
                <h2>Новичок</h2>
                <p>2 оборудования</p>
                <p>120 секунд</p>
                <div class="level-stars"></div>
                <div class="lock-icon hidden"></div>
            </div>
            <div class="level-card" data-level="2">
                <h2>Специалист</h2>
                <p>3 оборудования</p>
                <p>90 секунд</p>
                <div class="level-stars"></div>
                <div class="lock-icon"></div>
            </div>
            <div class="level-card" data-level="3">
                <h2>Эксперт</h2>
                <p>4 оборудования</p>
                <p>60 секунд</p>
                <div class="level-stars"></div>
                <div class="lock-icon"></div>
            </div>
            <div class="level-card" data-level="4">
                <h2>Мастер</h2>
                <p>5 оборудования</p>
                <p>45 секунд</p>
                <div class="level-stars"></div>
                <div class="lock-icon"></div>
            </div>
        </div>
        <button id="back-to-menu">Назад</button>
    </div>

    <!-- Игровой экран -->
    <div id="game-screen" class="screen hidden">
        <div class="game-header">
            <div class="header-left">
                <p class="level-name">Уровень: Новичок</p>
                <p class="timer">02:00</p>
            </div>
            <div class="header-right">
                <p class="feedback-message"></p>
            </div>
        </div>
        
        <div class="level-description">
            <p id="level-desc-text">Описание уровня загружается...</p>
        </div>
        
        <div class="game-container">
            <div class="playground-container">
                <div class="playground"></div>
            </div>
            
            <div class="equipment-panel-container">
                <div class="equipment-panel"></div>
            </div>
        </div>
        
        <div class="game-controls">
            <button id="hint-btn" class="hint-btn hidden">Подсказка</button>
            <button id="launch-btn" disabled>Запустить завод</button>
        </div>
    </div>

    <!-- Экран победы -->
    <div id="win-screen" class="screen hidden">
        <h1 class="win-text">Поздравляем!</h1>
        <p>Вы справились за <span id="time-spent">00:00</span>!</p>
        <p>Заработано звёзд: <span id="stars-earned">★★★</span></p>
        <button class="next-level-btn">Следующий уровень</button>
        <button class="restart-btn">Заново</button>
        <div class="confetti"></div>
    </div>

    <!-- Экран проигрыша -->
    <div id="lose-screen" class="screen hidden">
        <h1>Время вышло!</h1>
        <p>Завод не был запущен вовремя.</p>
        <button class="restart-btn">Попробовать снова</button>
    </div>

    <!-- Модальное окно для подсказок -->
    <div id="hint-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <p id="hint-text"></p>
        </div>
    </div>

    <audio id="success-sound" src="assets/sounds/success.mp3" preload="auto"></audio>
    <audio id="error-sound" src="assets/sounds/error.mp3" preload="auto"></audio>

    <script>
        // ВЕСЬ JAVASCRIPT КОД ЗДЕСЬ
        document.addEventListener('DOMContentLoaded', () => {
            // Конфигурация уровней с описаниями и подсказками
            const levels = {
                1: {
                    name: "Новичок",
                    time: 120,
                    slots: [
                        { id: "slot1", correct: "fermenter", number: 1 },
                        { id: "slot2", correct: "heat-exchanger", number: 2 }
                    ],
                    equipment: ["fermenter", "heat-exchanger"],
                    threshold3: 30,
                    threshold2: 60,
                    description: "На заводе аврал! Рома не перезванивает по поводу КП, а заказчик требует срочно подключить оборудование. Переставьте оборудование в правильной последовательности. На первом этапе установите ферментер, а затем теплообменник.",
                    hint: "Начните с ферментера - это основа процесса брожения."
                },
                2: {
                    name: "Специалист",
                    time: 90,
                    slots: [
                        { id: "slot1", correct: "fermenter", number: 1 },
                        { id: "slot2", correct: "heat-exchanger", number: 2 },
                        { id: "slot3", correct: "centrifuge", number: 3 }
                    ],
                    equipment: ["fermenter", "heat-exchanger", "centrifuge"],
                    threshold3: 25,
                    threshold2: 50,
                    description: "На предприятии ЧП - охранник перепутал схемы подключения. Помогите стажеру правильно подключить оборудование завода. Сначала установите ферментер, затем теплообменник, и в конце центрифугу для оптимальной работы системы.",
                    hint: "Теплообменник всегда следует после ферментера."
                },
                3: {
                    name: "Эксперт",
                    time: 60,
                    slots: [
                        { id: "slot1", correct: "boiler", number: 1 },
                        { id: "slot2", correct: "centrifuge", number: 2 },
                        { id: "slot3", correct: "fermenter", number: 3 },
                        { id: "slot4", correct: "heat-exchanger", number: 4 }
                    ],
                    equipment: ["fermenter", "heat-exchanger", "centrifuge", "boiler"],
                    threshold3: 20,
                    threshold2: 40,
                    description: "Все пошло не по плану! Нужно срочно переподключить оборудование в правильном порядке. Начните с котла, затем установите центрифугу, после этого ферментер и завершите теплообменником. Такая последовательность обеспечит бесперебойную работу.",
                    hint: "текст4текст4текст4"
                },
                4: {
                    name: "Мастер",
                    time: 45,
                    slots: [
                        { id: "slot1", correct: "boiler", number: 1 },
                        { id: "slot2", correct: "heat-exchanger", number: 2 },
                        { id: "slot3", correct: "fermenter", number: 3 },
                        { id: "slot4", correct: "centrifuge", number: 4 },
                        { id: "slot5", correct: "cooler", number: 5 }
                    ],
                    equipment: ["fermenter", "heat-exchanger", "centrifuge", "boiler", "cooler"],
                    threshold3: 30,
                    threshold2: 45,
                    description: "Я не понимаю как это подключить! - сказал главный инженер. Помогите правильно собрать сложную систему. Начните с котла, затем теплообменник, ферментер, центрифугу и завершите охладителем. Эта последовательность критически важна для безопасности и эффективности производства.",
                    hint: "текст5текст5текст5"
                }
            };

            // Элементы интерфейса
            const startScreen = document.getElementById('start-screen');
            const levelSelectScreen = document.getElementById('level-select-screen');
            const gameScreen = document.getElementById('game-screen');
            const winScreen = document.getElementById('win-screen');
            const loseScreen = document.getElementById('lose-screen');
            const startBtn = document.getElementById('start-btn');
            const backToMenuBtn = document.getElementById('back-to-menu');
            const levelCards = document.querySelectorAll('.level-card');
            const launchBtn = document.getElementById('launch-btn');
            const hintBtn = document.getElementById('hint-btn');
            const restartBtns = document.querySelectorAll('.restart-btn');
            const nextLevelBtn = document.querySelector('.next-level-btn');
            const timerDisplay = document.querySelector('.timer');
            const feedbackMessage = document.querySelector('.feedback-message');
            const timeSpentDisplay = document.getElementById('time-spent');
            const starsEarnedDisplay = document.getElementById('stars-earned');
            const levelNameDisplay = document.querySelector('.level-name');
            const levelDescText = document.getElementById('level-desc-text');
            const successSound = document.getElementById('success-sound');
            const errorSound = document.getElementById('error-sound');
            const hintModal = document.getElementById('hint-modal');
            const hintText = document.getElementById('hint-text');
            const closeModal = document.querySelector('.close-modal');

            // Игровые переменные
            let currentLevel = 1;
            let timeLeft = 0;
            let timer;
            let gameStarted = false;
            let equipmentPlaced = 0;
            let startTime;
            let selectedEquipment = null;
            let hintUsed = false;
            const isMobile = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
            
            // Прогресс игры
            const gameProgress = {
                unlockedLevels: [1],
                bestTimes: {},
                bestStars: {}
            };

            // Загрузка сохранений
            function loadProgress() {
                const saved = localStorage.getItem('breweryGameProgress');
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        gameProgress.unlockedLevels = parsed.unlockedLevels || [1];
                        gameProgress.bestTimes = parsed.bestTimes || {};
                        gameProgress.bestStars = parsed.bestStars || {};
                    } catch (e) {
                        console.error('Ошибка загрузки прогресса:', e);
                    }
                }
            }

            // Сохранение прогресса
            function saveProgress() {
                localStorage.setItem('breweryGameProgress', JSON.stringify(gameProgress));
            }

            // Инициализация игры
            function initGame(levelTime) {
                timeLeft = levelTime;
                equipmentPlaced = 0;
                gameStarted = true;
                startTime = Date.now();
                selectedEquipment = null;
                hintUsed = false;
                
                timerDisplay.textContent = formatTime(timeLeft);
                timerDisplay.classList.remove('low-time');
                feedbackMessage.textContent = '';
                feedbackMessage.className = 'feedback-message';
                launchBtn.disabled = true;
                
                // Управление видимостью кнопки подсказки
                if (currentLevel >= 3) {
                    hintBtn.classList.remove('hidden');
                    hintBtn.disabled = false;
                    hintBtn.style.opacity = '1';
                } else {
                    hintBtn.classList.add('hidden');
                }
                
                clearInterval(timer);
                timer = setInterval(updateTimer, 1000);
                
                // Предзагрузка звуков
                successSound.load().catch(e => console.log('Ошибка загрузки звука:', e));
                errorSound.load().catch(e => console.log('Ошибка загрузки звука:', e));
                
                // Предзагрузка изображений
                preloadEquipmentImages();
            }

            // Предзагрузка изображений оборудования
            function preloadEquipmentImages() {
                const level = levels[currentLevel];
                level.equipment.forEach(equipId => {
                    const img = new Image();
                    img.src = `assets/images/${equipId}.png`;
                });
            }

            // Форматирование времени
            function formatTime(seconds) {
                const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
                const secs = (seconds % 60).toString().padStart(2, '0');
                return `${mins}:${secs}`;
            }

            // Обновление таймера
            function updateTimer() {
                timeLeft--;
                timerDisplay.textContent = formatTime(timeLeft);
                
                if (timeLeft <= 10) {
                    timerDisplay.classList.add('low-time');
                }
                
                if (timeLeft <= 0) {
                    endGame(false);
                }
            }

            // Конец игры
            function endGame(isWin) {
                if (!gameStarted) return;
                
                clearInterval(timer);
                gameStarted = false;
                gameScreen.classList.add('hidden');
                
                const timeSpent = Math.floor((Date.now() - startTime) / 1000);
                timeSpentDisplay.textContent = formatTime(timeSpent);
                
                if (isWin) {
                    // Расчет звезд
                    const stars = calculateStars(timeSpent);
                    starsEarnedDisplay.textContent = '★'.repeat(stars) + '☆'.repeat(3 - stars);
                    
                    // Обновление прогресса
                    if (!gameProgress.bestTimes[currentLevel] || timeSpent < gameProgress.bestTimes[currentLevel]) {
                        gameProgress.bestTimes[currentLevel] = timeSpent;
                    }
                    
                    if (!gameProgress.bestStars[currentLevel] || stars > gameProgress.bestStars[currentLevel]) {
                        gameProgress.bestStars[currentLevel] = stars;
                    }
                    
                    // Разблокировка следующего уровня
                    if (currentLevel < 4 && !gameProgress.unlockedLevels.includes(currentLevel + 1)) {
                        gameProgress.unlockedLevels.push(currentLevel + 1);
                    }
                    
                    saveProgress();
                    updateLevelSelectScreen();
                    
                    winScreen.classList.remove('hidden');
                    try {
                        successSound.play();
                    } catch (e) {
                        console.log('Ошибка воспроизведения звука:', e);
                    }
                    createConfetti();
                } else {
                    loseScreen.classList.remove('hidden');
                    try {
                        errorSound.play();
                    } catch (e) {
                        console.log('Ошибка воспроизведения звука:', e);
                    }
                }
            }

            // Расчет звезд
            function calculateStars(timeSpent) {
                const level = levels[currentLevel];
                if (timeSpent <= level.threshold3) return 3;
                if (timeSpent <= level.threshold2) return 2;
                return 1;
            }

            // Создание конфетти
            function createConfetti() {
                const confettiContainer = document.querySelector('.confetti');
                confettiContainer.innerHTML = '';
                
                for (let i = 0; i < 100; i++) {
                    const confetti = document.createElement('div');
                    confetti.style.position = 'absolute';
                    confetti.style.width = '10px';
                    confetti.style.height = '10px';
                    confetti.style.backgroundColor = getRandomColor();
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = '-10px';
                    confetti.style.borderRadius = '50%';
                    confetti.style.animation = `fall ${Math.random() * 3 + 2}s linear forwards`;
                    
                    confettiContainer.appendChild(confetti);
                }
                
                const style = document.createElement('style');
                style.innerHTML = `
                    @keyframes fall {
                        to {
                            transform: translateY(calc(100vh + 10px)) rotate(${Math.random() * 360}deg);
                        }
                    }
                `;
                document.head.appendChild(style);
            }

            function getRandomColor() {
                const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
                return colors[Math.floor(Math.random() * colors.length)];
            }

            // Размещение оборудования
            function placeEquipment(slot, equipmentId) {
                if (slot.dataset.filled === 'true') return;
                
                const equipmentImg = document.createElement('img');
                equipmentImg.src = `assets/images/${equipmentId}.png`;
                equipmentImg.className = 'equipment-placed';
                equipmentImg.alt = equipmentId;
                
                slot.innerHTML = '';
                
                // Добавляем номер слота
                const slotNumber = document.createElement('div');
                slotNumber.className = 'slot-number';
                slotNumber.textContent = slot.dataset.number;
                slot.appendChild(slotNumber);
                
                slot.appendChild(equipmentImg);
                slot.dataset.filled = 'true';
                slot.dataset.equipment = equipmentId;
                
                document.querySelector(`.equipment-btn[data-equipment="${equipmentId}"]`).style.display = 'none';
                
                equipmentPlaced++;
                if (equipmentPlaced === levels[currentLevel].equipment.length) {
                    launchBtn.disabled = false;
                    feedbackMessage.textContent = 'Все оборудование размещено!';
                    feedbackMessage.classList.add('correct');
                }
            }

            // Инициализация уровня
            function initLevel(levelId) {
                currentLevel = levelId;
                const level = levels[levelId];
                
                // Очистка игрового поля
                document.querySelector('.playground').innerHTML = '';
                document.querySelector('.equipment-panel').innerHTML = '';
                
                // Установка названия уровня
                levelNameDisplay.textContent = `Уровень: ${level.name}`;
                
                // Установка описания уровня
                levelDescText.textContent = level.description;
                
                // Создание слотов
                level.slots.forEach(slotConfig => {
                    const slot = document.createElement('div');
                    slot.className = 'slot';
                    slot.id = slotConfig.id;
                    slot.dataset.correct = slotConfig.correct;
                    slot.dataset.number = slotConfig.number;
                    slot.dataset.filled = 'false';
                    
                    // Добавляем номер слота
                    const slotNumber = document.createElement('div');
                    slotNumber.className = 'slot-number';
                    slotNumber.textContent = slotConfig.number;
                    slot.appendChild(slotNumber);
                    
                    document.querySelector('.playground').appendChild(slot);
                });
                
                // Создание оборудования
                level.equipment.forEach(equipId => {
                    const btn = document.createElement('div');
                    btn.className = 'equipment-btn';
                    btn.dataset.equipment = equipId;
                    
                    const img = document.createElement('img');
                    img.src = `assets/images/${equipId}.png`;
                    img.className = 'equipment';
                    img.alt = equipId;
                    
                    btn.appendChild(img);
                    document.querySelector('.equipment-panel').appendChild(btn);
                });
                
                // Запуск игры
                initGame(level.time);
            }

            // Обновление экрана выбора уровня
            function updateLevelSelectScreen() {
                levelCards.forEach(card => {
                    const level = parseInt(card.dataset.level);
                    const lockIcon = card.querySelector('.lock-icon');
                    const starsContainer = card.querySelector('.level-stars');
                    
                    if (gameProgress.unlockedLevels.includes(level)) {
                        lockIcon.classList.add('hidden');
                        
                        // Показываем звезды для пройденных уровней
                        if (gameProgress.bestStars[level]) {
                            starsContainer.innerHTML = '★'.repeat(gameProgress.bestStars[level]) + 
                                                    '☆'.repeat(3 - gameProgress.bestStars[level]);
                        } else {
                            starsContainer.innerHTML = '';
                        }
                    } else {
                        lockIcon.classList.remove('hidden');
                        starsContainer.innerHTML = '';
                    }
                });
            }

            // Обработчики событий
            startBtn.addEventListener('click', () => {
                startScreen.classList.add('hidden');
                levelSelectScreen.classList.remove('hidden');
                loadProgress();
                updateLevelSelectScreen();
            });

            backToMenuBtn.addEventListener('click', () => {
                levelSelectScreen.classList.add('hidden');
                startScreen.classList.remove('hidden');
            });

            levelCards.forEach(card => {
                card.addEventListener('click', () => {
                    const level = parseInt(card.dataset.level);
                    if (gameProgress.unlockedLevels.includes(level)) {
                        levelSelectScreen.classList.add('hidden');
                        gameScreen.classList.remove('hidden');
                        initLevel(level);
                    }
                });
            });

            // Управление оборудованием
            function handleEquipmentSelection(equipmentBtn) {
                if (equipmentBtn.style.display !== 'none') {
                    selectedEquipment = equipmentBtn.dataset.equipment;
                    document.querySelectorAll('.equipment-btn').forEach(btn => {
                        btn.style.opacity = btn === equipmentBtn ? '1' : '0.5';
                    });
                    
                    feedbackMessage.textContent = `Выбрано: ${selectedEquipment.toUpperCase()}`;
                    feedbackMessage.className = 'feedback-message';
                }
            }

            function handleSlotPlacement(slot) {
                if (slot && selectedEquipment && slot.dataset.filled === 'false') {
                    placeEquipment(slot, selectedEquipment);
                    
                    selectedEquipment = null;
                    document.querySelectorAll('.equipment-btn').forEach(btn => {
                        btn.style.opacity = '1';
                    });
                }
            }

            // Обработка событий для мобильных и десктопов
            if (isMobile) {
                // Для мобильных устройств
                document.addEventListener('touchstart', (e) => {
                    const equipmentBtn = e.target.closest('.equipment-btn');
                    if (equipmentBtn) {
                        e.preventDefault();
                        handleEquipmentSelection(equipmentBtn);
                    }
                }, { passive: false });

                document.addEventListener('touchend', (e) => {
                    const slot = e.target.closest('.slot');
                    handleSlotPlacement(slot);
                });
            } else {
                // Для десктопов
                document.addEventListener('mousedown', (e) => {
                    const equipmentBtn = e.target.closest('.equipment-btn');
                    if (equipmentBtn) {
                        handleEquipmentSelection(equipmentBtn);
                    }
                });

                document.addEventListener('click', (e) => {
                    const slot = e.target.closest('.slot');
                    handleSlotPlacement(slot);
                });
            }

            // Кнопка подсказки
            hintBtn.addEventListener('click', () => {
                if (hintUsed) return;
                
                const level = levels[currentLevel];
                hintText.textContent = level.hint;
                hintModal.classList.remove('hidden');
                hintUsed = true;
                hintBtn.disabled = true;
                hintBtn.style.opacity = '0.6';
            });

            // Закрытие модального окна
            closeModal.addEventListener('click', () => {
                hintModal.classList.add('hidden');
            });

            // Закрытие модального окна по клику вне его
            window.addEventListener('click', (e) => {
                if (e.target === hintModal) {
                    hintModal.classList.add('hidden');
                }
            });

            // Кнопка запуска завода
            launchBtn.addEventListener('click', () => {
                const level = levels[currentLevel];
                let allCorrect = true;
                
                level.slots.forEach(slotConfig => {
                    const slot = document.getElementById(slotConfig.id);
                    if (slot.dataset.equipment !== slotConfig.correct) {
                        allCorrect = false;
                    }
                });
                
                if (allCorrect) {
                    feedbackMessage.textContent = 'Правильно! Завод запущен!';
                    feedbackMessage.classList.add('correct');
                    setTimeout(() => endGame(true), 1500);
                } else {
                    feedbackMessage.textContent = 'Неверно! Завод не может работать!';
                    feedbackMessage.classList.add('incorrect');
                    setTimeout(() => endGame(false), 1500);
                }
            });

            // Кнопки рестарта
            restartBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    winScreen.classList.add('hidden');
                    loseScreen.classList.add('hidden');
                    gameScreen.classList.remove('hidden');
                    initLevel(currentLevel);
                });
            });

            // Кнопка следующего уровня
            nextLevelBtn.addEventListener('click', () => {
                if (currentLevel < 4) {
                    winScreen.classList.add('hidden');
                    gameScreen.classList.remove('hidden');
                    initLevel(currentLevel + 1);
                } else {
                    winScreen.classList.add('hidden');
                    levelSelectScreen.classList.remove('hidden');
                }
            });

            // Предотвращение стандартного поведения для мобильных
            document.addEventListener('touchmove', (e) => {
                if (e.target.classList.contains('equipment-btn')) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            // Предзагрузка ресурсов при загрузке страницы
            window.addEventListener('load', () => {
                const sounds = [successSound, errorSound];
                sounds.forEach(sound => {
                    sound.load().catch(e => console.log('Ошибка предзагрузки звука:', e));
                });
                
                // Предзагрузка логотипа
                const logo = new Image();
                logo.src = 'assets/images/logo.png';
            });
        });
    </script>
</body>
</html>